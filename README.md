# builder

Generate golang builders.


## Installation

```bash
$ go install github.com/alextanhongpin/builder
```

## Usage

```go
//go:generate builder -type Simple
type Simple struct {
	name string
	customType YourSpecialType `build:"-"`
}
```

Output:

```go
// Code generated by builder, DO NOT EDIT.
package main

import "fmt"

type SimpleBuilder struct {
	simple Simple
	fields map[string]bool
}

func NewSimpleBuilder() *SimpleBuilder {
	return &SimpleBuilder{fields: map[string]bool{"name": false}}
}

// WithName sets name.
func (b SimpleBuilder) WithName(name string) SimpleBuilder {
	b.setOrPanic("name")
	b.simple.name = name
	return b
}

// Build returns Simple.
func (b SimpleBuilder) Build() Simple {
	for field, isSet := range b.fields {
		if !isSet {
			panic(fmt.Sprintf("builder.BuildErr: %q not set", field))
		}
	}
	return b.simple
}

// Build returns Simple.
func (b SimpleBuilder) BuildPartial() Simple {
	return b.simple
}

// setOrPanic sets the fields only if it has not yet been set. It will panic when calling it twice.
func (b *SimpleBuilder) setOrPanic(field string) {
	c := b.cloneFields()
	if c[field] {
		panic(fmt.Sprintf("builder.BuildErr: cannot set %q twice", field))
	}
	c[field] = true
	b.fields = c
}

// cloneFields clone the fields to avoid mutation
func (b SimpleBuilder) cloneFields() map[string]bool {
	result := make(map[string]bool)
	for k, v := range b.fields {
		result[k] = v
	}
	return result
}
```

## Ignoring and setting custom setter.

Sometimes you want a custom type, but also need to take advantage of the `Build()` which panics if not all the fields are set
```go
func (b SimpleBuilder) WithYourCustomWither(custom string) SimpleBuilder {
	b.setOrPanic("customType")
	b.simple.customType = NewCustomType(custom)
	return b
}

```

## Build


```go
func main() {
	builder := NewSimpleBuilder()
	log.Println(builder.BuildPartial()) // Allows the entity to be build partially.
	log.Println(builder)
	log.Println(builder.WithName("john"))
	log.Println(builder.WithName("john").Build())
	log.Println(builder)
	log.Println(builder.Build()) // This will panic, since "name" is not set yet.
}
```
