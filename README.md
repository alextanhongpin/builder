# builder

Generate golang builders.


## Installation

```bash
$ go install github.com/alextanhongpin/builder
```

## Usage

```go
//go:generate go run ../main.go -type Simple
type Simple struct {
	name string
	age  int `build:"-"`
}
```

<details>
	<summary>Output:</summary>
	
```go
// Code generated by builder, DO NOT EDIT.
package main

import "fmt"

type SimpleBuilder struct {
	simple    Simple
	fields    []string
	fieldsSet uint64
}

func NewSimpleBuilder(additionalFields ...string) *SimpleBuilder {
	for _, field := range additionalFields {
		if field == "" {
			panic("builder: empty string in constructor")
		}
	}
	exists := make(map[string]bool)
	fields := append([]string{"name"}, additionalFields...)
	for _, field := range fields {
		if exists[field] {
			panic(fmt.Sprintf("builder: duplicate field %q", field))
		}
		exists[field] = true
	}
	return &SimpleBuilder{fields: fields}
}

// WithName sets name.
func (b SimpleBuilder) WithName(name string) SimpleBuilder {
	b.mustSet("name")
	b.simple.name = name
	return b
}

// Build returns Simple.
func (b SimpleBuilder) Build() Simple {
	for i, field := range b.fields {
		if !b.isSet(i) {
			panic(fmt.Sprintf("builder: %q not set", field))
		}
	}
	return b.simple
}

// Build returns Simple.
func (b SimpleBuilder) BuildPartial() Simple {
	return b.simple
}

func (b *SimpleBuilder) mustSet(field string) {
	i := b.indexOf(field)
	if b.isSet(i) {
		panic(fmt.Sprintf("builder: set %q twice", field))
	}
	b.fieldsSet |= 1 << i
}

func (b SimpleBuilder) isSet(pos int) bool {
	return (b.fieldsSet & (1 << pos)) == (1 << pos)
}

func (b SimpleBuilder) indexOf(field string) int {
	for i, f := range b.fields {
		if f == field {
			return i
		}
	}
	panic(fmt.Sprintf("builder: field: %q not found", field))
}
```

</details>

## Ignoring and setting custom setter.

Sometimes you want a custom type, but also need to take advantage of the `Build()` which panics if not all the fields are set
```go
// Extend simple builder and check if the field is set.
func (s SimpleBuilder) WithCustomAge(age int) SimpleBuilder {
	s.mustSet("age")
	s.simple.age = age
	return s
}
```

## Build


```go
func main() {
	builder := NewSimpleBuilder("age")                              // Pass custom fields that needs to be set.
	log.Println(builder.BuildPartial())                             // Allows the entity to be build partially.
	log.Println(builder)                                            // None of the values are set yet.
	log.Println(builder.WithName("john"))                           // name is set to true
	log.Println(builder.WithName("john").WithCustomAge(10).Build()) // name and age set and build success
	log.Println(builder)                                            // Every instance is immutable and they don't share state.
	log.Println(builder.Build())                                    // This will panic, since "name" and "age" is not set yet.
}
```
